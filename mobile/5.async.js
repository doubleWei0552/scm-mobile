(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{EC9D:function(e,t,a){e.exports={menuactive:"menuactive___22uR5",goodsPage:"goodsPage___2gJ1V"}},LiL3:function(e,t,a){"use strict";var n=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("puyI");var o=n(a("xZH1"));a("XGli");var i=n(a("NHyu"));a("e3Tq");var d=n(a("n+tp"));a("B8GA");var s=n(a("8dL9"));a("KklG");var u=n(a("Zrtv"));a("1Cgs");var r=n(a("zvbH"));a("D2jH");var c=n(a("2ROE"));a("c5tJ");var f=n(a("Te4X")),g=n(a("eHn4"));a("RFiq");var m=n(a("ZyfH"));a("ra+K");var h=n(a("tM9S"));a("UzV/");var p,v,E,y=n(a("vLen")),x=n(a("2Taf")),S=n(a("vZ4D")),C=n(a("l4Ni")),b=n(a("ujKo")),w=n(a("MhPg")),I=n(a("gWZ8")),k=l(a("q1tI")),D=a("MuoO"),L=(n(a("mOP9")),n(a("LvDl"))),R=n(a("i8i4")),H=n(a("usdK")),M=n(a("EC9D")),z={},N=[],A=[];function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a="Section ".concat(e),n=L.default.findIndex(N,function(e){return e===a});n>-1||(N.push(a),z[a]=a,A[e-1]=[],L.default.map(t,function(t,a){A[e-1].push(t.ID),z[t.ID]=t.ID}),N=(0,I.default)(N),A=(0,I.default)(A))}var F=(p=(0,D.connect)(function(e){var t=e.goods,a=e.loading;return{goods:t,loading:a.models.goods}}),p((E=function(e){function t(e){var a;(0,x.default)(this,t),a=(0,C.default)(this,(0,b.default)(t).call(this,e)),a.getTypeList=function(){var e=a.props.dispatch;e({type:"goods/getTypeList",payload:{},callback:function(e){if("success"===e.status){var t=[L.default.get(e,"data[0].ID"),L.default.get(e,"data[0].childCategory[0].ID")];a.setState({value:t})}}})},a.getGoodsList=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=a.props.dispatch,n=a.state,l=n.pageIndex,o=n.value,i=1*localStorage.getItem("userId");e?setTimeout(function(){a.setState({dataSource:a.state.dataSource.cloneWithRowsAndSections(z,N,A),refreshing:!1})},1e3):t({type:"goods/getGoodsList",payload:{customerId:i,category:o[1]?o[1]:null,currentPage:l},callback:function(e){if("success"===e.status){var t=e.data.list;setTimeout(function(){T(l,t),a.setState({dataSource:a.state.dataSource.cloneWithRowsAndSections(z,N,A),isLoading:!1,pageIndex:l+1,show:!1,refreshing:!1})},1e3)}else a.setState({isLoading:!1,refreshing:!1})}})},a.onChange=function(e){var t=a.props.goods.menuData;t.forEach(function(t){t.value===e[0]&&(t.label,t.children&&e[1]&&t.children.forEach(function(t){t.value===e[1]&&" ".concat(t.label)}))}),a.setState({pageIndex:1,value:e,isLoading:!0},function(){z={},N=[],A=[],a.getGoodsList()})},a.handleClick=function(e){e.preventDefault(),a.setState({show:!a.state.show})},a.goBack=function(){window.history.back()},a.onMaskClick=function(){a.setState({show:!1})},a.onClose=function(){a.setState({modal2:!1})},a.confirmOrder=function(){var e=a.props.dispatch,t=a.state.cart;e({type:"goods/confirmOrder",payload:{list:t},callback:function(e){"success"===e.status&&(a.setState({modal2:!1}),H.default.push("/orderdetail/".concat(e.data)))}})},a.showModal=function(){a.setState({modal2:!0})},a.onEndReached=function(e){var t=a.state.pageIndex;a.state.isLoading&&!a.state.hasMore||a.setState({isLoading:!0,pageIndex:t},function(){a.getGoodsList()})},a.onRefresh=function(){a.setState({refreshing:!0},function(){a.getGoodsList(!0)})},a.stepperChange=function(e,t){var n=a.state.cart,l=L.default.findIndex(n,function(e){return e.ID===t.ID});l>-1?0===e?(L.default.remove(n,function(e){return e.ID===t.ID}),a.setState({cart:n})):(n[l].number=e,a.setState({cart:n})):(t.number=e,n.push(t),a.setState({cart:n}))};var n=function(e,t){return e[t]},l=function(e,t,a){return e[a]},o=new y.default.DataSource({getRowData:l,getSectionHeaderData:n,rowHasChanged:function(e,t){return e!==t},sectionHeaderHasChanged:function(e,t){return e!==t}});return a.state={dataSource:o,isLoading:!0,show:!1,pageIndex:1,height:3*document.documentElement.clientHeight/4,cart:[],modal2:!1,value:[]},a}return(0,w.default)(t,e),(0,S.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.goods,a=(t.menuData,t.list,this.state.pageIndex,document.documentElement.clientHeight-R.default.findDOMNode(this.lv).parentNode.offsetTop);this.getTypeList(),this.getGoodsList(),setTimeout(function(){e.setState({isLoading:!1,height:a})},600)}},{key:"componentWillReceiveProps",value:function(e){e.dataSource!==this.props.dataSource&&this.setState({dataSource:this.state.dataSource.cloneWithRowsAndSections(e.dataSource)})}},{key:"render",value:function(){var e=this,t=this.props.goods,a=t.menuData,n=t.list,l=this.state,p=(l.initData,l.show),v=l.dataSource,E=l.cart,x=l.value,S=l.isLoading;L.default.map(a,function(e){e.value=e.ID,e.label=e.NAME,e.children=e.childCategory,e.childCategory.length&&L.default.map(e.children,function(e){e.label=e.NAME,e.value=e.ID})});var C=0,b=0;L.default.map(E,function(e){C+=e.number,b+=(e.PRICE||0)*(e.number||1)});var w=k.default.createElement(h.default,{className:"foo-menu",data:a,value:x,onChange:this.onChange,level:2,height:.6*document.documentElement.clientHeight}),I=k.default.createElement("div",{style:{width:"100%",height:.6*document.documentElement.clientHeight,display:"flex",justifyContent:"center"}},k.default.createElement(m.default,{size:"large"})),D=function(e,t){return k.default.createElement("div",{key:t,style:{backgroundColor:"#F5F5F9",height:8,borderTop:"1px solid #ECECED",borderBottom:"1px solid #ECECED"}})},R=function(t,a,l){var o,i=L.default.findIndex(n,function(e){return e.ID===t}),d={};return i>-1&&(d=n[i]),k.default.createElement("div",{key:l,style:{padding:"0 15px"}},k.default.createElement("div",{style:{lineHeight:"43px",color:"rgba(0,0,0,0.8)",fontSize:18,fontWeight:500,borderBottom:"1px solid #F6F6F6",textAlign:"left"}},L.default.get(d,"GOODS_NAME")),k.default.createElement("div",{style:(o={display:"-webkit-box"},(0,g.default)(o,"display","flex"),(0,g.default)(o,"padding","5px 0"),o)},k.default.createElement("img",{style:{height:"64px",marginRight:"15px"},src:L.default.get(d,"img")||"https://zos.alipayobjects.com/rmsportal/dKbkpPXKfvZzWCM.png",alt:""}),k.default.createElement("div",{style:{lineHeight:1,flex:1}},k.default.createElement("div",{style:{marginBottom:"8px",fontWeight:"bold",textAlign:"left"}},L.default.get(d,"des","\u6211\u662f\u5546\u54c1\u63cf\u8ff0")),k.default.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},k.default.createElement("div",{style:{fontSize:"30px",color:"#FF6E27"}},k.default.createElement("span",{style:{fontSize:18,color:"rgba(0,0,0,0.65)"}},"\u4ef7\u683c\uff1a"),L.default.get(d,"PRICE")),k.default.createElement(f.default,{style:{minWidth:"100px"},showNumber:!0,max:10,min:0,step:1,defaultValue:0,onChange:function(t){return e.stepperChange(t,d)}})))))};return k.default.createElement("div",{ref:function(t){return e.content=t},className:p?M.default.menuactive:M.default.goodsPage},k.default.createElement(m.default,{toast:!0,text:"Loading...",animating:S}),k.default.createElement("div",{style:{position:"fixed",top:0,zIndex:10,width:"100%"}},k.default.createElement(r.default,{icon:k.default.createElement(c.default,{type:"left",size:"lg"}),onLeftClick:this.goBack,rightContent:[k.default.createElement(c.default,{onClick:this.handleClick,key:"1",type:"ellipsis"})],className:"top-nav-bar"},"\u5546\u54c1\u5217\u8868")),p?a?w:I:null,p?k.default.createElement("div",{className:"menu-mask",onClick:this.onMaskClick}):null,k.default.createElement(y.default,{ref:function(t){return e.lv=t},dataSource:v,renderRow:R,renderSeparator:D,style:{height:p?document.documentElement.clientHeight-140:document.documentElement.clientHeight-95,overflow:"auto",top:45},pageSize:4,scrollRenderAheadDistance:400,onEndReached:this.onEndReached,onEndReachedThreshold:10,pullToRefresh:k.default.createElement(u.default,{refreshing:this.state.refreshing,onRefresh:this.onRefresh})}),k.default.createElement("div",{className:"animated fadeIn",style:{position:"fixed",bottom:0,zIndex:10,width:"100%",display:E.length>0?"block":"none"}},k.default.createElement(r.default,{mode:"light",icon:k.default.createElement(s.default,{text:C,style:{marginLeft:12}},"\u8d2d\u7269\u8f66"),onLeftClick:this.showModal,rightContent:[k.default.createElement("span",{key:3,onClick:this.showModal},"\u7acb\u5373\u4e0b\u5355")]})),k.default.createElement(o.default,{popup:!0,className:"goodsModal",visible:this.state.modal2,onClose:this.onClose,animationType:"slide-up",style:{height:.6*document.documentElement.clientHeight}},k.default.createElement("div",{className:"title"},"\u8d2d\u7269\u8f66"),k.default.createElement(d.default,{style:{height:.6*document.documentElement.clientHeight-113,overflow:"auto"},className:"popup-list"},E.map(function(t,a){return k.default.createElement(d.default.Item,{key:t.id,style:{display:"flex"}},k.default.createElement("img",{style:{height:"64px",width:"64px",marginRight:"15px"},src:L.default.get(t,"img")||"https://zos.alipayobjects.com/rmsportal/dKbkpPXKfvZzWCM.png",alt:""}),k.default.createElement("div",{style:{flex:1,textAlign:"right"}},k.default.createElement("div",{style:{fontSize:"20px",lineHeight:"24px",textAlign:"left"}},L.default.get(t,"GOODS_NAME")," "),k.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},k.default.createElement("div",{style:{fontSize:"16px",color:"#FF6E27",textAlign:"left"}},k.default.createElement("span",{style:{fontSize:16,color:"rgba(0,0,0,0.65)"}},"\u4ef7\u683c\uff1a"),L.default.get(t,"PRICE")),k.default.createElement(f.default,{style:{minWidth:"100px"},showNumber:!0,max:10,min:0,step:1,defaultValue:t.number,onChange:function(a){return e.stepperChange(a,t)}}))))}),k.default.createElement(d.default.Item,null,k.default.createElement("div",{style:{lineHeight:"36px"}},"\u5171",k.default.createElement("span",null,E.length),"\u79cd\uff0c",k.default.createElement("span",null,C),"\u4ef6"),k.default.createElement("div",{style:{flex:"1",textAlign:"right"}},"\u603b\u4ef7\uff1a",k.default.createElement("span",{style:{color:"#FF6E27",fontSize:24}},b)))),k.default.createElement(i.default,{style:{width:"95%",margin:"0 auto",top:"12px"},type:"primary",onClick:this.confirmOrder},"\u786e\u8ba4\u4e0b\u5355")))}}]),t}(k.Component),v=E))||v),P=F;t.default=P}}]);